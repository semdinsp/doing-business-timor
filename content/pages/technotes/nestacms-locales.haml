Categories: Technical Notes
Template: home
Summary: Internationalize NestaCMS using iI8n.
Date: 7 Novbmer 2013

.container
  .row
    .col-md-9
      %h1 Internationalize NestaCMS
      :markdown
        This was reasonably simple to do.  Please check the following site for full details [tl lotto](http://github.com/semdinsp/tl-lotto-com).  I have attached the update app.rb file below for full details. The key items were adding i8N o gemfile, using sessions and creating a post route for the language. I also had to update the Page class so that any translations would be added to the menus.
      
      %pre
        %code
          module Nesta
          class App
          not_found do
          cache haml("404".to_sym)
          end
          enable :sessions
          before do
          if request.path_info =~ Regexp.new('./$')
          redirect to(request.path_info.sub(Regexp.new('/$'), ''))
          end
          I18n.locale = session[:language] if session[:language]!=nil
          end
          configure do
          I18n::Backend::Simple.send(:include, I18n::Backend::Fallbacks)
          I18n.load_path=Dir[File.join(settings.root, 'config/locales', '*.yml')]
          I18n.backend.load_translations
          I18n.locale = 'en'
          end
          post '/lang/:id' do
          lang=params[:id]
          I18n.locale =lang if ['en','tet','ba'].include?(lang)
          session[:language]=lang if ['en','tet','ba'].include?(lang)
          redirect to('/')
          end
          end
          class Page
          def heading
          regex = case @format
          when :mdown
          s*(.*?)(\s*#+|$)/
          when :haml
          s*%h1\s+(.*)/
          when :textile
          s*h1\.\s+(.*)/
          end
          markup =~ regex
          val=Regexp.last_match(1) or raise HeadingNotSet
          val=eval(val[1..val.size]) if val[0]=='='
          val
          end
          end
          end

    .col-md-3
      = haml :technote_menu, :layout => false